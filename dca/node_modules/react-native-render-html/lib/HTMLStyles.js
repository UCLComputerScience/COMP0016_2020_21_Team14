var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.cssStringToObject=cssStringToObject;exports.cssObjectToString=cssObjectToString;exports.constructStyles=constructStyles;exports.computeTextStyles=computeTextStyles;exports.getElementClassStyles=getElementClassStyles;exports.getElementCSSClasses=getElementCSSClasses;exports.cssStringToRNStyle=cssStringToRNStyle;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _HTMLUtils=require("./HTMLUtils");var _HTMLDefaultStyles=require("./HTMLDefaultStyles");function cssStringToObject(str){return str.split(";").map(function(prop){return prop.split(":");}).reduce(function(acc,prop){if(prop.length===2){acc[prop[0].trim()]=prop[1].trim();}return acc;},{});}function cssObjectToString(obj){var string="";Object.keys(obj).forEach(function(style){string+=style+":"+obj[style]+";";});return string;}function constructStyles(_ref){var tagName=_ref.tagName,htmlAttribs=_ref.htmlAttribs,passProps=_ref.passProps,additionalStyles=_ref.additionalStyles,_ref$styleSet=_ref.styleSet,styleSet=_ref$styleSet===void 0?"VIEW":_ref$styleSet,baseFontSize=_ref.baseFontSize;var defaultTextStyles=(0,_HTMLDefaultStyles.generateDefaultTextStyles)(baseFontSize);var defaultBlockStyles=(0,_HTMLDefaultStyles.generateDefaultBlockStyles)(baseFontSize);passProps.ignoredStyles.forEach(function(ignoredStyle){htmlAttribs[ignoredStyle]&&delete htmlAttribs[ignoredStyle];});var style=[(styleSet==="VIEW"?defaultBlockStyles:defaultTextStyles)[tagName],passProps.tagsStyles?passProps.tagsStyles[tagName]:undefined,getElementClassStyles(htmlAttribs,passProps.classesStyles),htmlAttribs.style?cssStringToRNStyle(htmlAttribs.style,_HTMLUtils.STYLESETS[styleSet],(0,_extends2.default)({},passProps,{parentTag:tagName})):undefined];if(additionalStyles){style=style.concat(!additionalStyles.length?[additionalStyles]:additionalStyles);}return style.filter(function(s){return s!==undefined;});}function computeTextStyles(element,passProps){var finalStyle={};var parentStyles=_recursivelyComputeParentTextStyles(element,passProps);parentStyles.forEach(function(styles){Object.keys(styles).forEach(function(styleKey){var styleValue=styles[styleKey];if(!finalStyle[styleKey]){finalStyle[styleKey]=styleValue;}});});return(0,_extends2.default)({},passProps.baseFontStyle,finalStyle);}function _recursivelyComputeParentTextStyles(element,passProps){var styles=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var attribs=element.attribs,name=element.name;var classesStyles=passProps.classesStyles,tagsStyles=passProps.tagsStyles,defaultTextStyles=passProps.defaultTextStyles;var HTMLAttribsStyles=attribs&&attribs.style?cssStringToRNStyle(attribs.style,_HTMLUtils.STYLESETS.TEXT,passProps):{};var classStyles=getElementClassStyles(attribs,classesStyles);var userTagStyles=tagsStyles[name];var defaultTagStyles=defaultTextStyles[name];var mergedStyles=(0,_extends2.default)({},defaultTagStyles,userTagStyles,classStyles,HTMLAttribsStyles);styles.push(mergedStyles);if(element.parent){return _recursivelyComputeParentTextStyles(element.parent,passProps,styles);}else{return styles;}}function getElementClassStyles(htmlAttribs){var classesStyles=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var elementClasses=getElementCSSClasses(htmlAttribs);var styles={};elementClasses.forEach(function(className){if(classesStyles[className]){styles=(0,_extends2.default)({},styles,classesStyles[className]);}});return styles;}function getElementCSSClasses(htmlAttribs){if(!htmlAttribs||!htmlAttribs.class){return[];}return htmlAttribs.class.split(" ");}function cssToRNStyle(css,styleset,_ref2){var emSize=_ref2.emSize,ptSize=_ref2.ptSize,ignoredStyles=_ref2.ignoredStyles,allowedStyles=_ref2.allowedStyles;var styleProps=_HTMLUtils.stylePropTypes[styleset];return Object.keys(css).filter(function(key){return allowedStyles?allowedStyles.indexOf(key)!==-1:true;}).filter(function(key){return(ignoredStyles||[]).indexOf(key)===-1;}).map(function(key){return[key,css[key]];}).map(function(_ref3){var _ref4=(0,_slicedToArray2.default)(_ref3,2),key=_ref4[0],value=_ref4[1];return[key.split("-").map(function(item,index){return index===0?item:item[0].toUpperCase()+item.substr(1);}).join(""),value];}).map(function(_ref5){var _ref6=(0,_slicedToArray2.default)(_ref5,2),key=_ref6[0],value=_ref6[1];if(styleProps.indexOf(key)===-1){return undefined;}if(typeof value==="string"){value=value.replace(/\s*!\s*important/,"");if(key==="display"&&["flex","none"].indexOf(value)===-1){return[key,"flex"];}if(key==="textAlign"){if(["left","right","justify","auto","center"].indexOf(value)!==-1){return[key,value];}if(value==="start"){return[key,"left"];}if(value==="end"){return[key,"right"];}return undefined;}if(value.replace(/[-_]/g,"").search(/\binherit\b|\bnormal\b|\bnone\b|(calc|var)\(.*\)/)!==-1){return undefined;}if(value.search(/[\d.]+%/)!==-1&&_HTMLUtils.PERC_SUPPORTED_STYLES.indexOf(key)!==-1){return[key,value];}if(value.search(/[\d.]+em/)!==-1){var pxSize=parseFloat(value.replace("em",""))*emSize;return[key,pxSize];}if(value.search(/[\d.]+pt/)!==-1){var _pxSize=parseFloat(value.replace("pt",""))*ptSize;return[key,_pxSize];}var numericValue=parseFloat(value.replace("px",""));if(key!=="fontWeight"&&!isNaN(numericValue)){if(styleProps.indexOf(key)!==-1){return[key,numericValue];}}if(key==="fontSize"){return mapAbsoluteFontSize(key,value);}}return[key,value];}).filter(function(prop){return prop!==undefined;}).reduce(function(acc,_ref7){var _ref8=(0,_slicedToArray2.default)(_ref7,2),key=_ref8[0],value=_ref8[1];acc[key]=value;return acc;},{});}function mapAbsoluteFontSize(key,value){var fontSize=value;if(_HTMLUtils.ABSOLUTE_FONT_SIZE.hasOwnProperty(value)){fontSize=_HTMLUtils.ABSOLUTE_FONT_SIZE[value];}return[key,fontSize];}function cssStringToRNStyle(str){var styleset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_HTMLUtils.STYLESETS.TEXT;var options=arguments.length>2?arguments[2]:undefined;return cssToRNStyle(cssStringToObject(str),styleset,options);}exports._getElementClassStyles=getElementClassStyles;exports._getElementCSSClasses=getElementCSSClasses;exports._constructStyles=constructStyles;